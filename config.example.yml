instances:
  - id: hetzner-s3
    repository: s3:https://fsn1.your-objectstorage.com/restic12t681
    schedule: "0 2 * * *" # Daily at 2 AM - backs up all targets assigned to this instance
    retention: "30d:12w:24m" # Optional: instance-specific retention (overrides global)
    resticTimeout: "10m" # Optional: instance-specific timeout (overrides global, default 5m)
    env:
      AWS_ACCESS_KEY_ID: your-access-key
      AWS_SECRET_ACCESS_KEY: your-secret-key
      AWS_DEFAULT_REGION: fsn1
      RESTIC_PASSWORD: your-restic-password
    targets:
      # Simple syntax (recommended for simple targets)
      - volume: app-uploads
      - volume: app-config
      - db: app-postgres # dbKind auto-detected from image (postgres, mysql, mariadb, mongo, redis)
      - db: app-mysql
      - db: app-mariadb

      # Full object syntax (use when you need custom settings)
      # - volume: app-uploads
      #   paths: ["/data", "/config"]  # Specific paths instead of root "/"
      #   stopAttached: true           # Stop containers during backup
      #   preHook: "echo Starting"     # Command before backup
      #   postHook: "echo Done"        # Command after backup
      # - db: app-postgres
      #   dbKind: postgres              # Override auto-detection
      #   dumpArgs: ["--clean", "--if-exists"]  # Custom dump arguments
      #   preHook: "psql -U myapp -c 'CHECKPOINT;'"

  - id: local-backup
    repository: /mnt/backup/restic
    schedule: "0 3 * * *" # Daily at 3 AM
    # No retention specified - will use global default below
    env:
      RESTIC_PASSWORD: your-restic-password
    targets:
      - volume: important-data

  - id: env-example
    repository: s3:https://nyc3.digitaloceanspaces.com/my-backup-bucket
    schedule: "30 2 * * *" # Daily at 2:30 AM
    env:
      AWS_ACCESS_KEY_ID: ${DO_SPACES_KEY}
      AWS_SECRET_ACCESS_KEY: ${DO_SPACES_SECRET}
      AWS_DEFAULT_REGION: nyc3
      RESTIC_PASSWORD: ${RESTIC_PASS}
    targets:
      - volume: ${BACKUP_VOLUME} # Environment variable expansion also works in targets
        paths: ["/data", "/config"]

  # Example: Custom Docker image backend (alternative to Restic)
  # - id: custom-backup
  #   customImage: marina/example-backup:latest # Custom Docker image
  #   schedule: "0 4 * * *" # Daily at 4 AM
  #   timeout: "15m" # Custom images may need different timeouts
  #   env:
  #     BACKUP_ENDPOINT: https://backup.example.com
  #     BACKUP_TOKEN: ${BACKUP_TOKEN}
  #   targets:
  #     - volume: custom-data

# Global defaults (can be overridden by instance config or target config)
# If not specified here, Marina uses hardcoded defaults:
#   - retention: "7d:4w:6m" (7 daily, 4 weekly, 6 monthly)
#   - stopAttached: false
#   - resticTimeout: "60m" (60 minutes)
#   - dbPath: "/var/lib/marina/marina.db"
#   - apiPort: "8080"
retention: "14d:8w:12m" # Format: daily:weekly:monthly - applies to all instances unless overridden
stopAttached: true # Stop containers when backing up volumes (can be overridden per target)
resticTimeout: "60m" # Global timeout for backup operations (format: "5m", "30s", "1h") - can be overridden per instance

# Runtime configuration
dbPath: "/var/lib/marina/marina.db" # Database path for job status and logs (default: "/var/lib/marina/marina.db")
apiPort: "8080" # API server port (default: "8080")
corsOrigins: # Additional CORS origins for API server (optional)
  - https://marina.example.com
  - https://backup.example.com
  # Or use environment variables:
  # - ${MARINA_CORS_ORIGIN}

# Mesh configuration (optional) - for connecting multiple Marina instances
# When configured, the dashboard will show backup schedules from all connected nodes
mesh:
  # Custom node name (defaults to hostname if not specified)
  nodeName: ${NODE_NAME} # or "production-server-1"

  # Authentication password for mesh and dashboard access
  # If not set, authentication is disabled
  # All nodes in the mesh should use the same password
  authPassword: ${MARINA_AUTH_PASSWORD} # or "your-secure-password"

  # List of peer Marina API URLs to fetch data from
  # Each peer should be reachable via HTTP/HTTPS
  peers:
    - http://marina-node2:8080
    - http://marina-node3:8080
    # Or use environment variables:
    # - ${PEER_NODE_1}
    # - ${PEER_NODE_2}
