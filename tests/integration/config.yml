instances:
  - id: local-integration
    repository: /repo
    schedule: "* * * * *" # Every minute for fast integration testing
    env:
      RESTIC_PASSWORD: testpass
    targets:
      - "db:pg-it"           # postgres container
      - "db:mysql-it"        # mysql container
      - db: mariadb-it       # mariadb container with hooks
        preHook: "mariadb -uroot -pmaripass -e 'CREATE DATABASE IF NOT EXISTS createdbeforefirstdump;'"
        postHook: "mariadb -uroot -pmaripass -e 'CREATE DATABASE IF NOT EXISTS createdafterfirstdump;'"
      - "db:mongo-it"        # mongo container
      - db: pg-empty-it      # postgres-empty container
        preHook: "echo '#!/bin/sh' > /usr/local/bin/pg_dumpall && echo 'exit 0' >> /usr/local/bin/pg_dumpall && chmod +x /usr/local/bin/pg_dumpall"
      - "volume:integration_testdata"    # volume-writer data (prefixed by docker-compose)
      - "volume:integration_testdata-empty"  # volume-writer-empty data (prefixed by docker-compose)

# Global defaults
retention: "7d:4w:6m"
stopAttached: true
resticTimeout: "30s"

mesh:
  nodeName: server1
  authPassword: mesh
  peers:
    - http://marina-it-mesh-2:8081
